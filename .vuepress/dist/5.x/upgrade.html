<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Upgrade Guide | Laravel PayU</title>
    <meta name="generator" content="VuePress 1.5.4">
    <link href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,800,800i,900,900i" rel="stylesheet" type="text/css">
    <meta name="description" content="PayU Payment Gateway Integration for Laravel">
    <link rel="preload" href="/assets/css/0.styles.6a0f084f.css" as="style"><link rel="preload" href="/assets/js/app.706ebfa5.js" as="script"><link rel="preload" href="/assets/js/2.aa980102.js" as="script"><link rel="preload" href="/assets/js/18.17ac4854.js" as="script"><link rel="preload" href="/assets/js/3.99db4cda.js" as="script"><link rel="prefetch" href="/assets/js/10.28f61c60.js"><link rel="prefetch" href="/assets/js/11.b7dd8238.js"><link rel="prefetch" href="/assets/js/12.2d177dd1.js"><link rel="prefetch" href="/assets/js/13.5cb19351.js"><link rel="prefetch" href="/assets/js/14.5b377573.js"><link rel="prefetch" href="/assets/js/15.a0535b08.js"><link rel="prefetch" href="/assets/js/16.bf1b0a62.js"><link rel="prefetch" href="/assets/js/17.cd211b35.js"><link rel="prefetch" href="/assets/js/19.e150e3bd.js"><link rel="prefetch" href="/assets/js/20.7f897dcd.js"><link rel="prefetch" href="/assets/js/4.f1dadef0.js"><link rel="prefetch" href="/assets/js/5.282f3f21.js"><link rel="prefetch" href="/assets/js/6.3be36d8b.js"><link rel="prefetch" href="/assets/js/7.5e2090ef.js"><link rel="prefetch" href="/assets/js/8.f1f3d1eb.js"><link rel="prefetch" href="/assets/js/9.16d29d1b.js">
    <link rel="stylesheet" href="/assets/css/0.styles.6a0f084f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Laravel PayU</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div> <a href="https://github.com/tzsk/payu" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div> <a href="https://github.com/tzsk/payu" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Getting Started</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/5.x/introduction.html" class="sidebar-link">Introduction</a></li><li><a href="/5.x/installation.html" class="sidebar-link">Installation</a></li><li><a href="/5.x/configuration.html" class="sidebar-link">Configuration</a></li><li><a href="/5.x/changes.html" class="sidebar-link">About 5.x</a></li><li><a href="/5.x/upgrade.html" aria-current="page" class="active sidebar-link">Upgrade Guide</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Features</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/5.x/features/payment.html" class="sidebar-link">Payment</a></li><li><a href="/5.x/features/concerns.html" class="sidebar-link">Concerns</a></li><li><a href="/5.x/features/gateways.html" class="sidebar-link">Gateways</a></li><li><a href="/5.x/features/relationship.html" class="sidebar-link">Relationship</a></li><li><a href="/5.x/features/verification.html" class="sidebar-link">Verification</a></li><li><a href="/5.x/features/events.html" class="sidebar-link">Events</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="upgrade-guide"><a href="#upgrade-guide" class="header-anchor">#</a> Upgrade Guide</h1> <p></p><div class="table-of-contents"><ul><li><a href="#system-requirements">System Requirements</a></li><li><a href="#steps-to-upgrade">Steps to Upgrade</a><ul><li><a href="#step-1-update-composer-dependency">Step - 1: Update Composer Dependency</a></li><li><a href="#step-2-cleanup-config">Step - 2: Cleanup Config</a></li><li><a href="#step-3-publish-new-config-migration">Step - 3: Publish New Config / Migration</a></li><li><a href="#step-4-restore-config">Step - 4: Restore Config</a></li><li><a href="#step-5-make-payment">Step - 5: Make Payment</a></li><li><a href="#step-6-import-old-data">Step - 6: Import Old Data</a></li><li><a href="#step-7-change-model-polymorphic">Step - 7: Change Model (Polymorphic)</a></li></ul></li><li><a href="#done">Done</a></li></ul></div><p></p> <p>If you are using older version of Laravel PayU with <code>Session</code> driver, then this would be much easier. Otherwise you might have some difficulties importing old <code>payu_payments</code> database table into the new <code>payu_transactions</code> table.</p> <h2 id="system-requirements"><a href="#system-requirements" class="header-anchor">#</a> System Requirements</h2> <ul><li>You should be running <code>PHP &gt;= 7.4</code>.</li> <li>You need to have Laravel <code>&gt;= 7.x</code> for Laravel PayU <code>5.x</code></li></ul> <h2 id="steps-to-upgrade"><a href="#steps-to-upgrade" class="header-anchor">#</a> Steps to Upgrade</h2> <h3 id="step-1-update-composer-dependency"><a href="#step-1-update-composer-dependency" class="header-anchor">#</a> Step - 1: Update Composer Dependency</h3> <p>First off, you will need to update your composer dependency.</p> <ul><li>Change the version in your <code>composer.json</code> to make it look like <code>&quot;tzsk/payu&quot;: &quot;^5.0&quot;</code>.</li> <li>After that you should run <code>composer update</code> to update the <code>lock</code> file.</li></ul> <h3 id="step-2-cleanup-config"><a href="#step-2-cleanup-config" class="header-anchor">#</a> Step - 2: Cleanup Config</h3> <p>The config file structure and the migration also changed significantly so it is better to delete them to start fresh.</p> <ul><li>Delete old <code>config/payu.php</code> config file.</li></ul> <div class="custom-block tip"><p class="custom-block-title">Backup</p> <p>Make sure you backup your <code>payu_payments</code> table data and gateway config so that you can easily setup again.</p></div> <h3 id="step-3-publish-new-config-migration"><a href="#step-3-publish-new-config-migration" class="header-anchor">#</a> Step - 3: Publish New Config / Migration</h3> <p>Once you have cleared old files publish the new config and database migration file.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>php artisan payu:publish --config --migration

php artisan migrate
</code></pre></div><h3 id="step-4-restore-config"><a href="#step-4-restore-config" class="header-anchor">#</a> Step - 4: Restore Config</h3> <p>Once you migrated the new <code>payu_transactions</code> table you just need to configure the new <code>config/payu.php</code> file.</p> <h3 id="step-5-make-payment"><a href="#step-5-make-payment" class="header-anchor">#</a> Step - 5: Make Payment</h3> <p>Refactor the place where you make the payment in your application and change it to the new Fluent Interface according to the <a href="/usage">Usage</a></p> <h3 id="step-6-import-old-data"><a href="#step-6-import-old-data" class="header-anchor">#</a> Step - 6: Import Old Data</h3> <p>I've created a Gist on github which defines a Command file which just dumps all the old transactions to the new table. It attaches all the old entries to the correct gateway entry in your newly setup config file.</p> <ul><li>Gist File: <a href="https://github.com/tzsk" target="_blank" rel="noopener noreferrer">PayuMigrateCommand<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <p>This command file should expose an artisan command <code>php artisan payu:migrate</code>. Place it inside the Commands folder of your Laravel App and you should be able to run in. If you have custom namespace setup for your app don't forget to change the namespace of the file.</p> <div class="custom-block tip"><p class="custom-block-title">Heads Up</p> <p>Make sure you update your config and set the default you have been using in your old setup. And depending on how many records you have in your old payments table this might take a while.</p></div> <h3 id="step-7-change-model-polymorphic"><a href="#step-7-change-model-polymorphic" class="header-anchor">#</a> Step - 7: Change Model (Polymorphic)</h3> <p>This only applies if you are using the Polymorphic relation that 4.x provided.</p> <ul><li>Now the new trait that Laravel PayU exposes is <code>Tzsk\Payu\Models\HasTransactions</code>.</li> <li>And change the occurrences where you used the relationship <code>$entity-&gt;payments()</code> to <code>$entity-&gt;transactions()</code></li> <li>Also where ever you have fetched reverse relation from <code>PayuPayment</code> model instance like: <code>$payment-&gt;payable()</code>, update that to the new <code>$transaction-&gt;paidFor()</code> relation.</li></ul> <h2 id="done"><a href="#done" class="header-anchor">#</a> Done</h2> <p>Finally you are all done, If you want you can keep the old <code>payu_payments</code> table or get rid of that. It's totally up to you.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/tzsk/payu/edit/master/5.x/upgrade.md" target="_blank" rel="noopener noreferrer">Help improve this page!</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/5.x/changes.html" class="prev">
        About 5.x
      </a></span> <span class="next"><a href="/5.x/features/payment.html">
        Payment
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.706ebfa5.js" defer></script><script src="/assets/js/2.aa980102.js" defer></script><script src="/assets/js/18.17ac4854.js" defer></script><script src="/assets/js/3.99db4cda.js" defer></script>
  </body>
</html>
