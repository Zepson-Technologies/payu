<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Verification | Laravel PayU</title>
    <meta name="generator" content="VuePress 1.5.4">
    <link href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,800,800i,900,900i" rel="stylesheet" type="text/css">
    <meta name="description" content="PayU Payment Gateway Integration for Laravel">
    <link rel="preload" href="/assets/css/0.styles.6a0f084f.css" as="style"><link rel="preload" href="/assets/js/app.706ebfa5.js" as="script"><link rel="preload" href="/assets/js/2.aa980102.js" as="script"><link rel="preload" href="/assets/js/15.a0535b08.js" as="script"><link rel="preload" href="/assets/js/3.99db4cda.js" as="script"><link rel="prefetch" href="/assets/js/10.28f61c60.js"><link rel="prefetch" href="/assets/js/11.b7dd8238.js"><link rel="prefetch" href="/assets/js/12.2d177dd1.js"><link rel="prefetch" href="/assets/js/13.5cb19351.js"><link rel="prefetch" href="/assets/js/14.5b377573.js"><link rel="prefetch" href="/assets/js/16.bf1b0a62.js"><link rel="prefetch" href="/assets/js/17.cd211b35.js"><link rel="prefetch" href="/assets/js/18.17ac4854.js"><link rel="prefetch" href="/assets/js/19.e150e3bd.js"><link rel="prefetch" href="/assets/js/20.7f897dcd.js"><link rel="prefetch" href="/assets/js/4.f1dadef0.js"><link rel="prefetch" href="/assets/js/5.282f3f21.js"><link rel="prefetch" href="/assets/js/6.3be36d8b.js"><link rel="prefetch" href="/assets/js/7.5e2090ef.js"><link rel="prefetch" href="/assets/js/8.f1f3d1eb.js"><link rel="prefetch" href="/assets/js/9.16d29d1b.js">
    <link rel="stylesheet" href="/assets/css/0.styles.6a0f084f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Laravel PayU</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div> <a href="https://github.com/tzsk/payu" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div> <a href="https://github.com/tzsk/payu" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Getting Started</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/5.x/introduction.html" class="sidebar-link">Introduction</a></li><li><a href="/5.x/installation.html" class="sidebar-link">Installation</a></li><li><a href="/5.x/configuration.html" class="sidebar-link">Configuration</a></li><li><a href="/5.x/changes.html" class="sidebar-link">About 5.x</a></li><li><a href="/5.x/upgrade.html" class="sidebar-link">Upgrade Guide</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Features</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/5.x/features/payment.html" class="sidebar-link">Payment</a></li><li><a href="/5.x/features/concerns.html" class="sidebar-link">Concerns</a></li><li><a href="/5.x/features/gateways.html" class="sidebar-link">Gateways</a></li><li><a href="/5.x/features/relationship.html" class="sidebar-link">Relationship</a></li><li><a href="/5.x/features/verification.html" aria-current="page" class="active sidebar-link">Verification</a></li><li><a href="/5.x/features/events.html" class="sidebar-link">Events</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="verification"><a href="#verification" class="header-anchor">#</a> Verification</h1> <p></p><div class="table-of-contents"><ul><li><a href="#manually-verify">Manually Verify</a></li><li><a href="#verify-in-queue">Verify in Queue</a></li><li><a href="#verify-in-cron">Verify in CRON</a></li></ul></div><p></p> <p>It might happen that many time you customer will be redirected to the PayU payment gateway and they successfully paid but somehow due to network issue they did not return to the Capture Page.</p> <p>This might lead to the transactions stuck in <code>PENDING</code> state but in reality they should be successful. Best user experience would be to automatically verify the transaction, rather than the user contacting the back office team and manually verify the transaction.</p> <h2 id="manually-verify"><a href="#manually-verify" class="header-anchor">#</a> Manually Verify</h2> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$invoice</span> <span class="token operator">=</span> Invoice<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Get the transactions that are pending.</span>
<span class="token variable">$transactions</span> <span class="token operator">=</span> <span class="token variable">$invoice</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">transactions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">pending</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Verify Now</span>
<span class="token variable">$transactions</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">each</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">verify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Even if there are 2 <code>PENDING</code> transactions and they are from different Gateways one from <code>PayuBiz</code> one from <code>PayuMoney</code> it can successfully verify them both.</p> <h2 id="verify-in-queue"><a href="#verify-in-queue" class="header-anchor">#</a> Verify in Queue</h2> <p>If you want to verify the transaction in a queue then you just have to dispatch the job Laravel PayU provides out of the box.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Tzsk<span class="token punctuation">\</span>Payu<span class="token punctuation">\</span>Jobs<span class="token punctuation">\</span>VerifyTransaction</span><span class="token punctuation">;</span>

<span class="token variable">$transactions</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">each</span><span class="token punctuation">(</span>fn <span class="token punctuation">(</span><span class="token variable">$transaction</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> VerifyTransaction<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token variable">$transaction</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Or better yet,</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$transactions</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">each</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">verifyAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">When to Dispatch</p> <p>Best solution is when the user visits the Order Detail which is still in pending status. You can dispatch the job right then so that it can go ahead and verify on demand.</p></div> <p>You can easily check if a Transaction is verified or not by calling <code>$transaction-&gt;verified()</code> method. This will return boolean depending on the verification status.</p> <p><strong>Remember:</strong> A failed transaction can also be Verified. Verified doesn't mean it is successful.</p> <h2 id="verify-in-cron"><a href="#verify-in-cron" class="header-anchor">#</a> Verify in CRON</h2> <p>If you think about it, this is actually the practical solution. Cause the customer never returned to your application after payment that's why there is this issue of Transactions Stuck in <code>PENDING</code> state. So the best solution is to add it in a scheduled task for every 15 mins.</p> <p>Laravel PayU has you covered in this area as well. It comes with a verification command out of the box. Just add this line in the <code>schedule</code> method of your <code>console/Kernel.php</code>.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$schedule</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'payu:verify'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">everyFifteenMinutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">Status List to Verify</p> <p>You can specify which status of the transaction needs to be verified in the payu config file. <code>verify</code> key. By default it is set to <code>PayuTransaction::STATUS_PENDING</code>.</p></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/tzsk/payu/edit/master/5.x/features/verification.md" target="_blank" rel="noopener noreferrer">Help improve this page!</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/5.x/features/relationship.html" class="prev">
        Relationship
      </a></span> <span class="next"><a href="/5.x/features/events.html">
        Events
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.706ebfa5.js" defer></script><script src="/assets/js/2.aa980102.js" defer></script><script src="/assets/js/15.a0535b08.js" defer></script><script src="/assets/js/3.99db4cda.js" defer></script>
  </body>
</html>
